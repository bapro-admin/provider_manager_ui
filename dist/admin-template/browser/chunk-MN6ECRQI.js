import{A as Me,B as Se,C as Ue,D as be,E as ve,F as Ee,G as De,H as Re,I as we,J as xe,a as H,b as q,c as G,d as $,e as z,f as J,g as K,h as Q,i as W,j as X,k as Y,m as E,n as D,o as ee,p as te,q as ie,r as re,s as ae,t as ne,u as oe,v as se,w as ge,x as _e,y as Ce}from"./chunk-HNON273B.js";import{K as Oe,q as j,u as R,v as Z,w}from"./chunk-67QNU7YQ.js";import{O as V,S as le,T as x,V as me,W as de,_ as ce,aa as ue,ba as pe,fa as fe,ha as he}from"./chunk-BTRDCSZN.js";import{Ba as T,Ca as k,Cb as m,Gb as d,Kb as p,Pb as o,Qb as n,Rb as h,Sb as _,Tb as C,Vb as I,Yb as g,_b as y,dd as L,ed as B,jc as s,kb as l,kc as A,lb as f,lc as b,ma as O,qa as U,rc as v,wc as N,yc as P}from"./chunk-VWWPF74O.js";function Fe(e,t){e&1&&s(0," Actualizar usuario ")}function Ie(e,t){e&1&&s(0," Agregar usuario ")}function Ae(e,t){e&1&&(o(0,"mat-error"),s(1," El nombre de usuario es obligatorio. "),n())}function Ne(e,t){e&1&&(o(0,"mat-error"),s(1," Debe ser un correo electr\xF3nico v\xE1lido. "),n())}function Pe(e,t){e&1&&(o(0,"mat-error"),s(1," La contrase\xF1a es obligatoria. "),n())}var F=(()=>{let t=class t{constructor(i){this.fb=i,this.dialogRef=O(ee),this.data=O(te),this.hidePassword=!0,this.userForm=this.fb.group({username:["",[x.required,x.email]],password:["",x.required],role:[{value:"OPERATOR",disabled:!0}]})}ngOnInit(){this.data&&(this.userForm.get("username")?.disable(),this.userForm.patchValue({username:this.data.username,role:this.data.role}))}onNoClick(){this.dialogRef.close()}saveUserData(){if(this.userForm.invalid){this.userForm.markAllAsTouched();return}let i=this.userForm.getRawValue();i.password||delete i.password,this.dialogRef.close(i)}};t.\u0275fac=function(a){return new(a||t)(f(fe))},t.\u0275cmp=U({type:t,selectors:[["app-user-mgmt-dialog"]],standalone:!0,features:[v],decls:34,vars:10,consts:[["mat-dialog-title",""],[3,"formGroup"],[1,"row","mt-2"],[1,"col-12"],["appearance","outline",1,"full-width"],["matInput","","formControlName","username"],["appearance","outline",1,"full-width","mt-2"],["matInput","","formControlName","password","placeholder","********",3,"type"],["mat-icon-button","","matSuffix","",3,"click"],["formControlName","role",3,"disabled"],["value","OPERATOR"],["mat-button","","mat-dialog-close","","color","warn"],["mat-button","","color","primary",3,"click","disabled"]],template:function(a,r){if(a&1&&(o(0,"h2",0),m(1,Fe,1,0)(2,Ie,1,0),n(),o(3,"mat-dialog-content")(4,"form",1)(5,"div",2)(6,"div",3)(7,"mat-form-field",4)(8,"mat-label"),s(9,"Nombre de usuario"),n(),h(10,"input",5),m(11,Ae,2,0,"mat-error")(12,Ne,2,0,"mat-error"),n()(),o(13,"div",3)(14,"mat-form-field",6)(15,"mat-label"),s(16,"Password"),n(),h(17,"input",7),o(18,"button",8),g("click",function(){return r.hidePassword=!r.hidePassword}),o(19,"mat-icon"),s(20),n()(),m(21,Pe,2,0,"mat-error"),n()(),o(22,"div",3)(23,"mat-form-field",4)(24,"mat-label"),s(25,"Rol"),n(),o(26,"mat-select",9)(27,"mat-option",10),s(28,"Operador"),n()()()()()()(),o(29,"mat-dialog-actions")(30,"button",11),s(31,"Cancelar"),n(),o(32,"button",12),g("click",function(){return r.saveUserData()}),s(33,"Guardar"),n()()),a&2){let u,M,S;l(),p(r.data?1:-1),l(),p(r.data?-1:2),l(2),d("formGroup",r.userForm),l(7),p((u=r.userForm.get("username"))!=null&&u.hasError("required")?11:-1),l(),p((M=r.userForm.get("username"))!=null&&M.hasError("email")?12:-1),l(5),d("type",r.hidePassword?"password":"text"),l(3),A(r.hidePassword?"visibility":"visibility_off"),l(),p((S=r.userForm.get("password"))!=null&&S.hasError("required")?21:-1),l(5),d("disabled",!0),l(6),d("disabled",r.userForm.invalid)}},dependencies:[Se,Me,ge,_e,Ce,be,Ue,he,ce,le,me,de,ue,pe,w,R,Z,ae,ne,oe,re,Ee,ve,j,D,E],styles:[".full-width[_ngcontent-%COMP%]{width:100%}"]});let e=t;return e})();function Le(e,t){e&1&&(o(0,"th",12),s(1," Nombre de Usuario "),n())}function Be(e,t){if(e&1&&(o(0,"td",13),s(1),n()),e&2){let c=t.$implicit;l(),b(" ",c.username," ")}}function Ve(e,t){e&1&&(o(0,"th",12),s(1," Rol "),n())}function je(e,t){if(e&1&&(o(0,"td",13),s(1),n()),e&2){let c=t.$implicit;l(),b(" ",c.role," ")}}function He(e,t){e&1&&(o(0,"th",12),s(1," Fecha de Creaci\xF3n "),n())}function qe(e,t){if(e&1&&(o(0,"td",13),s(1),N(2,"date"),n()),e&2){let c=t.$implicit;l(),b(" ",P(2,1,c.created_at,"dd/MM/yyyy")," ")}}function Ge(e,t){e&1&&(o(0,"th",12),s(1," Acciones "),n())}function $e(e,t){if(e&1){let c=I();o(0,"td",13)(1,"mat-icon",14),g("click",function(){let a=T(c).$implicit,r=y();return k(r.editUser(a))}),n(),o(2,"mat-icon",15),g("click",function(){let a=T(c).$implicit,r=y();return k(r.deleteUserDialog(a.id_user))}),n()()}}function ze(e,t){e&1&&h(0,"tr",16)}function Je(e,t){e&1&&h(0,"tr",17)}function Ke(e,t){e&1&&(o(0,"mat-card",11)(1,"mat-card-content")(2,"h3"),h(3,"mat-icon",18),s(4," No tienes usuarios registrados "),n()()())}var Et=(()=>{let t=class t{constructor(i,a,r,u){this.userServ=i,this.snackBar=a,this.dialog=r,this.sessionServ=u,this.displayedColumns=["username","role","creationdate","actions"],this.dataSource=[],this.usersList=[],this.currentUser="",this.registeredUsersCount=0,this.maxUsers=40}ngOnInit(){let i=this.sessionServ.getUser();this.currentUser=i.username,this.retrieveUsers()}ngOnDestroy(){this.dialog.closeAll()}addUser(){if(this.registeredUsersCount>=this.maxUsers){this.openSnackbar(`El n\xFAmero m\xE1ximo de usuarios es ${this.maxUsers}. No puedes agregar m\xE1s.`,"Ok");return}this.dialog.open(F,{}).afterClosed().subscribe(a=>{if(a){let r=a;this.createUser(r)}})}editUser(i){this.dialog.open(F,{data:i}).afterClosed().subscribe(r=>{if(r){let M={password:r.password};this.userServ.updateUser(i.id_user,M).subscribe(()=>{this.openSnackbar("Se actualiz\xF3 el usuario correctamente","Ok"),this.retrieveUsers()},S=>{console.log("ERROR ON UPDATE USER ",S),this.openSnackbar("Ocurri\xF3 un error al actualizar el usuario","Ok")})}})}deleteUserDialog(i){this.dialog.open(se,{data:{title:"Eliminar Usuario",message:"\xBFSeguro que quieres eliminar este usuario?"}}).afterClosed().subscribe(r=>{r&&this.deleteUser(i)})}createUser(i){this.userServ.createUser(i).subscribe(()=>{console.log("USUARIO CREADO CORRECTAMENTE"),this.openSnackbar("Se gener\xF3 el usuario correctamente","Ok"),this.retrieveUsers()},a=>{console.log("ERROR ON LIST USERS ",a),this.openSnackbar("Ocurri\xF3 un error al obtener a los usuarios","Ok")})}deleteUser(i){this.userServ.deleteUser(i).subscribe(()=>{console.log("USUARIO BORRADO CORRECTAMENTE"),this.openSnackbar("Se elimin\xF3 el usuario correctamente","Ok"),this.retrieveUsers()},a=>{console.log("ERROR ON DELETE USER ",a),this.openSnackbar("Ocurri\xF3 un error al eliminar el usuario","Ok")})}retrieveUsers(){this.userServ.listUsers().subscribe(i=>{this.usersList=i.users,this.usersList=this.usersList.filter(a=>a.username!==this.currentUser),this.dataSource=this.usersList,this.registeredUsersCount=this.usersList.length},i=>{console.log("ERROR ON LIST USERS ",i),this.openSnackbar("Ocurri\xF3 un error al obtener a los usuarios","Ok")})}openSnackbar(i,a){this.snackBar.open(i,a,{duration:3e3})}};t.\u0275fac=function(a){return new(a||t)(f(xe),f(Oe),f(ie),f(V))},t.\u0275cmp=U({type:t,selectors:[["app-user-management"]],standalone:!0,features:[v],decls:19,vars:4,consts:[[1,"d-flex","justify-content-end"],["mat-raised-button","",1,"mt-3","mb-4","primary-button",3,"click"],["mat-table","",1,"mat-elevation-z2","mb-4",3,"dataSource"],["matColumnDef","username"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","role"],["matColumnDef","creationdate"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["appearance","outlined",1,"empty-records","d-flex","justify-content-center","align-items-center"],["mat-header-cell",""],["mat-cell",""],["aria-hidden","false","aria-label","Delete user","fontIcon","edit",1,"action-icon",3,"click"],["aria-hidden","false","aria-label","Delete user","fontIcon","delete",1,"action-icon",3,"click"],["mat-header-row",""],["mat-row",""],["aria-hidden","false","aria-label","Delete user","fontIcon","report",1,"empty-records-icon"]],template:function(a,r){a&1&&(o(0,"div",0)(1,"button",1),g("click",function(){return r.addUser()}),s(2,"Agregar usuario"),n()(),o(3,"table",2),_(4,3),m(5,Le,2,0,"th",4)(6,Be,2,1,"td",5),C(),_(7,6),m(8,Ve,2,0,"th",4)(9,je,2,1,"td",5),C(),_(10,7),m(11,He,2,0,"th",4)(12,qe,3,4,"td",5),C(),_(13,8),m(14,Ge,2,0,"th",4)(15,$e,3,0,"td",5),C(),m(16,ze,1,0,"tr",9)(17,Je,1,0,"tr",10),n(),m(18,Ke,5,0,"mat-card",11)),a&2&&(l(3),d("dataSource",r.dataSource),l(13),d("matHeaderRowDef",r.displayedColumns),l(),d("matRowDefColumns",r.displayedColumns),l(),p(r.usersList.length<=0?18:-1))},dependencies:[Y,H,G,K,$,q,Q,z,J,W,X,B,L,D,E,w,R,we,De,Re],styles:['@charset "UTF-8";table[_ngcontent-%COMP%]{width:100%}.action-icon[_ngcontent-%COMP%]{cursor:pointer}.primary-button[_ngcontent-%COMP%]{background-color:#212631!important;color:#fff!important}.empty-records[_ngcontent-%COMP%]{min-height:150px;border-radius:0}.empty-records-icon[_ngcontent-%COMP%]{font-size:36px;height:36px;width:36px;line-height:36px}']});let e=t;return e})();export{Et as UserManagementComponent};
